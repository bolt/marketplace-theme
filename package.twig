{% extends "layout.twig" %}

{% block ga_extras %}
    ga('set', 'page', '/view/<package-uuid>');
    ga('set', 'dimension2', '{{ package.id }}');
    ga('set', 'dimension3', '{{ package.title }}');
{% endblock %}

{% block header_title %} | {{ package.title }}{% endblock %}

{% block header_extra_scripts %}
    <script>
        var packageID = "{{ package.id }}";
    </script>

    <script src="{{ app.paths.theme }}js/jquery.scrollbar.min.js"></script>
    <script src="//cdn.jsdelivr.net/zeroclipboard/2.2.0/ZeroClipboard.min.js"></script>
    <script src="{{ app.paths.theme }}js/extension-extras.js"></script>
{% endblock header_extra_scripts %}

{% block content %}

    <div class="ui grid stackable">
        <div class="eight wide column">
            <h2 class="ui header">
                <img class="ui rounded image" src="{{ packageIcon(package) }}">
                <div class="content">
                    {{ package.title }}
                    <div class="sub header">by {{ package.authors|join(', ') }}</div>
                </div>
            </h2>
        </div>
        <div class="right floated right aligned eight wide column">

            <div class="ui icon buttons">

                {% if is_member() %}
                    {% set member = member() %}
                    {% if member.guid == package.account_id %}
                        <a href="{{ url('edit',{'package':package.id}) }}" class="ui primary button"> Edit<i class="right wrench icon"></i> </a>
                        <a href="{{ url('update',{'package':package.id}) }}" class="ui orange button"> Update<i class="right repeat icon"></i> </a>
                        {% if webhook and not webhook.latest %}
                            <form action="{{ url('hookCreator') }}" method="post">
                                <input type="hidden" name="user" value="{{ webhook.user }}">
                                <input type="hidden" name="repo" value="{{ webhook.repo }}">
                                <input type="hidden" name="token" value="{{ webhook.token }}">

                                {% if webhook.token %}
                                    <button type="submit" class="ui green button">Add GitHub webhook<i class="right wrench icon"></i></button>
                                {% else %}
                                    <button type="submit" disabled="disabled" class="ui green button">Add GitHub webhook<i class="right wrench icon"></i></button>
                                {% endif %}

                            </form>
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if boltthemes and boltthemes.active %}
                    <a class="ui orange button"
                       href="{{ boltthemes.preview_page }}?utm_source=bolt-extension-store&utm_medium=detailpage&utm_term=livepreview&utm_content=theme-livepreview&utm_campaign={{ package.title|url_encode }}"
                       target="_blank"
                       onclick="ga('send', 'event', {
                               eventCategory: 'Package',
                               eventAction: 'Live Preview',
                               eventLabel: '{{ package.title }}'
                               });"> View Live Preview </a>
                {% endif %}
                <button class="ui toggle button"
                        id="copy-button"
                        data-content="{{ package.name }}"
                        data-title="Click to copy the package name"
                        data-clipboard-text="{{ package.name }}"><i class="alternate copy icon"></i> Copy to clipboard
                </button>
                <button class="ui green button">FREE</button>
            </div>

            <div class="ui right floated main menu">
                <a class="bug popup icon item" data-content="Downloads" href="#">
                    <i class="download icon"> {{ statistics.downloads(package.id)|default(0) }}</i>
                </a>

                {% if is_member() %}
                    {% if statistics.isStarredBy(package.id, member.guid) %}
                        {% set star_text = "You have starred this package." %}
                    {% else %}
                        {% set star_text = "Star this package!" %}
                    {% endif %}
                {% else %}
                    {% set star_text = "You must be logged in to star packages." %}
                {% endif %}
                <a class="bug popup icon item"
                    {% if is_member() %}
                        {% if statistics.isStarredBy(package.id, member.guid) %}
                        {%- else %}
                            href="{{ url('star', { 'package': package.id }) }}"
                            onclick="ga('send', 'event', {
                                    eventCategory: 'Package',
                                    eventAction: 'Star',
                                    eventLabel: '{{ package.title }}'
                                    });"
                        {% endif %}
                    {% endif %}
                    data-content="{{ star_text }}">
                    <i class="star icon"> {{ statistics.stars(package.id)|default(0) }}</i>
                </a>

                <a class="github popup icon item"
                   data-content="View source code"
                   target="_blank"
                   href="{{ package.source }}"
                   onclick="ga('send', 'event', {
                           eventCategory: 'Package',
                           eventAction: 'View Source',
                           eventLabel: '{{ package.title }}'
                           });"
                >
                    {% if "github.com" in package.source %}
                        <i class="alternate github icon"></i>
                    {% else %}
                        <i class="alternate code icon"></i>
                    {% endif %}
                </a>
            </div>
        </div>
    </div>

    <br>

    {% if package.screenshots %}
        <h2 class="ui left floated header">Screenshots</h2>
        <div class="ui clearing divider"></div>
        <div class="slide_gallery scrollbar-inner">
            <div class="gallery" id="scroll_gallery">
                {% for image in package.screenshots %}
                    {% if "//" in image %}
                        <img class="image_gallery" src="{{ image }}">
                    {% else %}
                        <img class="image_gallery"
                             src="{{ package.source|replace({ ('github.com'): 'raw.githubusercontent.com'}) }}/master/{{ image }}">
                    {% endif %}
                {% endfor %}
            </div>

        </div>
        <br>
    {% endif %}

    <div class="ui grid stackable">

        <div class="ten wide column">
            <h2 class="ui left floated header">Description</h2>
            <div class="ui clearing divider"></div>
            <p style="font-size: 110%;">{{ package.description }}</p>

            <h2 class="ui left floated header">Changelog &amp; Releases</h2>
            <div class="ui clearing divider"></div>

            <div class="releases-wrapper">
                Loading releases â€¦
            </div>
        </div>

        <div class="six wide column">
            <h2 class="ui left floated header">More Info</h2>
            <div class="ui clearing divider"></div>

            <div class="ui relaxed large divided list">
                <div class="item">
                    <i class="large file code outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Created</span>
                        <div class="description">{{ package.created.date|date('jS M Y') }}</div>
                    </div>
                </div>
                <div class="item">
                    <i class="large flag outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Latest Version(s)</span>
                        <div class="description">
                            {% if versions %}
                                <ul>
                                    {% for name, value in versions %}
                                        <li>{{ value.pretty_version|default('unknown') }} (Bolt v{{ name }}+)</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="item">
                    <i class="large history middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Last Update</span>
                        <div class="description">
                            <ul>
                                {% if updated.stable %}
                                    {% set rel_ver = updated.stable %}
                                    <li>{{ rel_ver.updated.date|date('jS F Y')  }} (Release)</li>
                                {% endif %}
                                {% if updated.dev is not empty %}
                                    {% set dev_ver = updated.dev %}
                                    <li>{{ dev_ver.updated.date|date('jS F Y')  }} (Development)</li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="item">
                    <i class="large folder outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Category</span>
                        <div class="description">
                            {% if "bolt-extension" == package.type %}
                                Plugin
                            {% else %}
                                Theme
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="item">
                    <i class="large tags middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Tags</span>
                        <div class="description">
                            {% for tag in package.keywords %}
                                <a href="{{ url('browse') }}?q={{ tag }}"><span class="label tags">{{ tag }}</span></a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="six wide column">
                {% if suggested %}
                    <h2 class="ui left floated header">Suggested Packages</h2>
                    <div class="ui clearing divider"></div>

                    <div class="ui relaxed large divided vertical list related_list">
                        {% for suggest in suggested %}
                            {% if suggest.package != package %}
                                <div class="item">
                                    <img class="ui avatar image" src="{{ packageIcon(suggest.package) }}">
                                    <div class="content">
                                        <a class="header"
                                           href="{{ url('view', { 'package': suggest.package.id }) }}">{{ suggest.package.title }}</a>
                                        {{ suggest.description }}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}

                <h2 class="ui left floated header">Related</h2>
                <div class="ui clearing divider"></div>

                <div class="ui relaxed large divided vertical list related_list">
                    {% for relation in related %}
                        {% if relation != package %}
                            <div class="item">
                                <img class="ui avatar image" src="{{ packageIcon(relation) }}">
                                <div class="content">
                                    <a class="header" href="{{ url('view',{ 'package': relation.id }) }}">{{ relation.title }}</a>
                                    {{ relation.name }}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="ten wide column">
            <h2 class="ui left floated header">Comments</h2>
            <div class="ui clearing divider"></div>
            {{ include('partials/_disqus_comments.twig') }}
        </div>

    </div>

{% endblock %}
